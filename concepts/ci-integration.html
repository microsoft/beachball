<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CI Integration | beachball</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="The Sunniest Semantic Version Bumper">
    
    <link rel="preload" href="/beachball/assets/css/0.styles.09cf0da3.css" as="style"><link rel="preload" href="/beachball/assets/js/app.b3b4e057.js" as="script"><link rel="preload" href="/beachball/assets/js/2.88913962.js" as="script"><link rel="preload" href="/beachball/assets/js/1.73cf2610.js" as="script"><link rel="preload" href="/beachball/assets/js/31.77c50f29.js" as="script"><link rel="prefetch" href="/beachball/assets/js/10.92d6fa24.js"><link rel="prefetch" href="/beachball/assets/js/11.ac410d1b.js"><link rel="prefetch" href="/beachball/assets/js/12.f49a328a.js"><link rel="prefetch" href="/beachball/assets/js/13.52f471c5.js"><link rel="prefetch" href="/beachball/assets/js/14.b59c1ecc.js"><link rel="prefetch" href="/beachball/assets/js/15.ae1cb0ff.js"><link rel="prefetch" href="/beachball/assets/js/16.61ee0d11.js"><link rel="prefetch" href="/beachball/assets/js/17.b5cce3d7.js"><link rel="prefetch" href="/beachball/assets/js/18.4faca617.js"><link rel="prefetch" href="/beachball/assets/js/19.0741f0b9.js"><link rel="prefetch" href="/beachball/assets/js/20.9f94b747.js"><link rel="prefetch" href="/beachball/assets/js/21.25765253.js"><link rel="prefetch" href="/beachball/assets/js/22.55e67d05.js"><link rel="prefetch" href="/beachball/assets/js/23.0a3f4489.js"><link rel="prefetch" href="/beachball/assets/js/24.6582fe90.js"><link rel="prefetch" href="/beachball/assets/js/25.02d24b1b.js"><link rel="prefetch" href="/beachball/assets/js/26.1c2fccda.js"><link rel="prefetch" href="/beachball/assets/js/27.b8c66699.js"><link rel="prefetch" href="/beachball/assets/js/28.5c6ce295.js"><link rel="prefetch" href="/beachball/assets/js/29.024e32cd.js"><link rel="prefetch" href="/beachball/assets/js/3.6de1f7e9.js"><link rel="prefetch" href="/beachball/assets/js/30.f30b4679.js"><link rel="prefetch" href="/beachball/assets/js/32.145800d4.js"><link rel="prefetch" href="/beachball/assets/js/33.33d823b2.js"><link rel="prefetch" href="/beachball/assets/js/34.1c68993c.js"><link rel="prefetch" href="/beachball/assets/js/35.889e84bf.js"><link rel="prefetch" href="/beachball/assets/js/36.52db8aad.js"><link rel="prefetch" href="/beachball/assets/js/4.6d51c302.js"><link rel="prefetch" href="/beachball/assets/js/5.8aacd55a.js"><link rel="prefetch" href="/beachball/assets/js/6.e3b04c93.js"><link rel="prefetch" href="/beachball/assets/js/7.f1dd9a86.js"><link rel="prefetch" href="/beachball/assets/js/vendors~docsearch.271bc088.js">
    <link rel="stylesheet" href="/beachball/assets/css/0.styles.09cf0da3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/beachball/" class="home-link router-link-active"><!----> <span class="site-name">beachball</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/beachball/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/beachball/overview/getting-started.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="https://github.com/microsoft/beachball" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/beachball/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/beachball/overview/getting-started.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="https://github.com/microsoft/beachball" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/beachball/overview/installation.html" class="sidebar-link">Installation</a></li><li><a href="/beachball/overview/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/beachball/overview/configuration.html" class="sidebar-link">Configuration</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Concepts</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/beachball/concepts/bump-algorithm.html" class="sidebar-link">Bump Algorithm</a></li><li><a href="/beachball/concepts/change-files.html" class="sidebar-link">Change Files</a></li><li><a href="/beachball/concepts/ci-integration.html" aria-current="page" class="active sidebar-link">CI Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/beachball/concepts/ci-integration.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/beachball/concepts/ci-integration.html#setting-options-for-publishing" class="sidebar-link">Setting options for publishing</a></li><li class="sidebar-sub-header"><a href="/beachball/concepts/ci-integration.html#publishing" class="sidebar-link">Publishing</a></li></ul></li><li><a href="/beachball/concepts/groups.html" class="sidebar-link">Version Groups</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Command Line Args</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/beachball/cli/options.html" class="sidebar-link">Common Options</a></li><li><a href="/beachball/cli/bump.html" class="sidebar-link">bump</a></li><li><a href="/beachball/cli/change.html" class="sidebar-link">change</a></li><li><a href="/beachball/cli/check.html" class="sidebar-link">check</a></li><li><a href="/beachball/cli/publish.html" class="sidebar-link">publish</a></li><li><a href="/beachball/cli/sync.html" class="sidebar-link">sync</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ci-integration"><a href="#ci-integration" class="header-anchor">#</a> CI Integration</h1> <p>There are two parts to CI integration with <code>beachball</code>:</p> <ol><li><a href="./change-files#validating-change-files">Add a PR build step</a> to call <code>beachball check</code> to validate that change files are included.</li> <li>Add a release build step to call <code>beachball publish</code> to publish to npm and push back to git (this page).</li></ol> <p>To automate the bumping of package versions based on change files, you'll need to configure your release workflow/pipeline so that <code>beachball publish</code> has write access to the git repo and npm registry. The exact steps will vary between CI systems, but general concepts as well as steps for some common setups are outlined below.</p> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <p>Automated publishing from a GitHub repo to the public npm registry (<code>registry.npmjs.org</code>) typically uses personal access tokens for authentication. These tokens are stored as secrets in your CI system. You should ensure that these secrets are only available to release builds.</p> <p>For Azure DevOps repos publishing to a private registry, there are other possible approaches (such as using a service account with credentials stored in a key vault) which are not currently covered by these docs.</p> <h3 id="generating-tokens"><a href="#generating-tokens" class="header-anchor">#</a> Generating tokens</h3> <h4 id="npm-token"><a href="#npm-token" class="header-anchor">#</a> npm token</h4> <p>If publishing to the public npm registry (<code>registry.npmjs.org</code>), <a href="https://docs.npmjs.com/creating-and-viewing-access-tokens#creating-granular-access-tokens-on-the-website" target="_blank" rel="noopener noreferrer">create a granular access token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with write access to only the relevant package(s) and/or scope(s). Classic automation tokens are not recommended due to their overly broad permissions.</p> <h4 id="github-token"><a href="#github-token" class="header-anchor">#</a> GitHub token</h4> <p>You should use <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/managing-a-branch-protection-rule" target="_blank" rel="noopener noreferrer">branch protection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for your <code>main</code>/<code>master</code> branch, but this creates some difficulties for pushing changes back during automated publishing.</p> <p>The main way to allow <code>beachball</code> to push back to a repo with branch protections is by using a <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#personal-access-tokens-classic" target="_blank" rel="noopener noreferrer">classic personal access token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with <code>repo</code> permissions. (If the repo is part of an organization that uses SAML single sign-on (SSO), be sure to <a href="https://docs.github.com/en/authentication/authenticating-with-saml-single-sign-on/authorizing-a-personal-access-token-for-use-with-saml-single-sign-on" target="_blank" rel="noopener noreferrer">authorize the token for SSO access<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.) Since classic PATs have broad permissions, they must only be accessible to release builds—<a href="#storing-tokens">instructions below</a>.</p> <p>An alternative approach is creating a classic PAT with a &quot;machine user&quot; account. Create a new account with an alternate email or <a href="https://en.wikipedia.org/wiki/Email_address#Subaddressing" target="_blank" rel="noopener noreferrer">subaddress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<code>+</code> address), give it contributor permissions to only this repo, and add it under &quot;Restrict who can push to matching branches&quot; in the branch protection rule.</p> <p>(It's unclear if/when branch policy bypass support will be added for <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-fine-grained-personal-access-token" target="_blank" rel="noopener noreferrer">fine-grained PATs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>; it's been <a href="https://github.com/community/community/discussions/36441?sort=top#discussioncomment-4602435" target="_blank" rel="noopener noreferrer">requested<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> by users with no response and doesn't seem to be on the <a href="https://github.com/orgs/github/projects/4247/views/1" target="_blank" rel="noopener noreferrer">public roadmap<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The <a href="https://docs.github.com/en/actions/security-guides/automatic-token-authentication" target="_blank" rel="noopener noreferrer">built-in <code>GITHUB_TOKEN</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> won't work for the same reason.)</p> <h3 id="storing-tokens"><a href="#storing-tokens" class="header-anchor">#</a> Storing tokens</h3> <h4 id="secrets-github-actions">GitHub Actions</h4> <p>To restrict secret access to appropriate branches, use an <strong><a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment" target="_blank" rel="noopener noreferrer">environment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>. (The docs for environments focus on cloud deployments or resources, but environments can also be used only for secret storage.)</p> <ol><li><a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#creating-an-environment" target="_blank" rel="noopener noreferrer">Create an environment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Restrict <a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#deployment-branches" target="_blank" rel="noopener noreferrer">deployment branches<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to &quot;Selected branches&quot; and add a rule to allow only your release branch(es) (often <code>main</code>/<code>master</code>).</li> <li><a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-an-environment" target="_blank" rel="noopener noreferrer">Add secrets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the npm and GitHub tokens.</li> <li>To <a href="https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment" target="_blank" rel="noopener noreferrer">use the environment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, add a key <code>environment: your-env-name</code> in your release workflow job. (Full example below.)</li></ol> <h4 id="secrets-azure-pipelines">Azure Pipelines</h4> <p>There are a couple of options here:</p> <ul><li>Use <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;tabs=yaml%2Cbatch#secret-variables" target="_blank" rel="noopener noreferrer">secret variables in your release pipeline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Use <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups?view=azure-devops&amp;tabs=classic" target="_blank" rel="noopener noreferrer">secrets in a variable group<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which can optionally be linked to a key vault. Ensure that this variable group is only accessible to your release pipeline.</li></ul> <h2 id="setting-options-for-publishing"><a href="#setting-options-for-publishing" class="header-anchor">#</a> Setting options for publishing</h2> <p>If you're passing any custom options besides the npm token to <code>beachball publish</code>, it's recommended to set them in either the <code>beachball</code> config (if they don't interfere with other commands), or a <code>package.json</code> script (if specific to <code>publish</code>).</p> <p>For example, the following script could be used for publishing public scoped packages:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;beachball publish --access public&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you're publishing to a private feed, <code>registry</code> should be set in the overall <code>beachball</code> config, since it's also used by the <code>sync</code> command. For example, if your beachball config is in the root <code>package.json</code> (or it works the same in a config file):</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;beachball&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://pkgs.dev.azure.com/some-org/_packaging/some-feed/npm/registry/&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="publishing"><a href="#publishing" class="header-anchor">#</a> Publishing</h2> <p>The exact publishing setup will vary depending on your CI setup, but the overall steps are as follows:</p> <ol><li>Ensure the git user name and email are set, or git will reject the commit. Somewhere in your pipeline:<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> config user.name <span class="token string">&quot;someone&quot;</span>
<span class="token function">git</span> config user.email <span class="token string">&quot;someone@example.com&quot;</span>
</code></pre></div></li> <li>Set up git authentication. This could use tokens (covered below), SSH keys, or some other non-interactive method.</li> <li>Set up npm authentication. This could use tokens passed on the command line (covered below), tokens set in <code>.npmrc</code>, or some other method.</li> <li>Run <code>beachball publish</code>!</li></ol> <h3 id="github-repo-github-actions"><a href="#github-repo-github-actions" class="header-anchor">#</a> GitHub repo + GitHub Actions</h3> <p>Here's a sample setup for publishing from a GitHub repo using GitHub actions. The environment, secret, and script names can be modified as you prefer.</p> <p>This sample assumes the following:</p> <ul><li>An environment called <code>release</code> (set up <a href="#secrets-github-actions">as described above</a>) with the following secrets:
<ul><li><code>REPO_PAT</code>: A GitHub classic personal access token with admin access (<a href="#generating-a-github-token">as described above</a>)</li> <li><code>NPM_TOKEN</code>: An npm token with write access to the package(s) and/or scope(s), such as a <a href="#generating-an-npm-token">fine-grained token for public npm</a></li></ul></li> <li>A repo root <code>package.json</code> script <code>release</code> which runs <code>beachball publish</code></li> <li>The build is running on a Linux/Mac agent. (This could be easily adapted to a Windows agent with different syntax in the commands.)</li></ul> <p>Note that in GitHub Actions, it's easiest to set up authentication if you set <code>persist-credentials: false</code> when checking out code.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># Example trigger configurations (choose one or more, or another setup)</span>
<span class="token comment"># on:</span>
<span class="token comment">#   # Release on push to main</span>
<span class="token comment">#   push:</span>
<span class="token comment">#     branches: [main]</span>
<span class="token comment">#   # Release daily (see https://crontab-generator.org/ for help with schedules)</span>
<span class="token comment">#   schedule:</span>
<span class="token comment">#     - cron: '0 8 * * *'</span>
<span class="token comment">#   # Release on manual trigger (can be used alone or with other options)</span>
<span class="token comment">#   workflow_dispatch:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span> release

<span class="token comment"># Variable syntax below assumes Linux/Mac but could be easily adapted to Windows</span>
<span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

<span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Check out code
    <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token comment"># Prevent the action from storing credentials in a way that's hard to override</span>
      <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token comment"># ... Other steps to prepare for publishing (install, build, test, etc) ...</span>

  <span class="token comment"># Set the name, email, and URL with PAT</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set git credentials
    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      git config user.name &quot;someone&quot;
      git config user.email &quot;someone@example.com&quot;
      git remote set-url origin &quot;https://$REPO_PAT@github.com/your-org/your-repo&quot;</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">REPO_PAT</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.REPO_PAT <span class="token punctuation">}</span><span class="token punctuation">}</span>

  <span class="token comment"># Pass the token on the command line for publishing</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Publish
    <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run release <span class="token punctuation">-</span><span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>token &quot;$NPM_TOKEN&quot;
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">NPM_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.NPM_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="github-repo-azure-pipelines"><a href="#github-repo-azure-pipelines" class="header-anchor">#</a> GitHub repo + Azure Pipelines</h3> <p>Here's a sample setup for publishing from a GitHub repo using Azure Pipelines. The environment, secret, and script names can be modified as you prefer.</p> <p>This sample assumes the following:</p> <ul><li>A variable group called <code>Beachball secrets</code> (set up <a href="#secrets-azure-pipelines">as described above</a>) with the following secrets:
<ul><li><code>GITHUB_PAT</code>: A GitHub classic personal access token with admin access (<a href="#generating-a-github-token">as described above</a>)</li> <li><code>NPM_TOKEN</code>: An npm token with write access to the package(s) and/or scope(s), such as a <a href="#generating-an-npm-token">fine-grained token for public npm</a></li></ul></li> <li>A repo root <code>package.json</code> script <code>release</code> which runs <code>beachball publish</code></li> <li>The build is running on a Linux/Mac agent. (This could be easily adapted to a Windows agent with different syntax in the commands.)</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># Example trigger configurations (choose one or more, or another setup)</span>
<span class="token comment">#</span>
<span class="token comment"># # Release on push to main</span>
<span class="token comment"># trigger: [main]</span>
<span class="token comment">#</span>
<span class="token comment"># # Release on a schedule</span>
<span class="token comment"># # https://docs.microsoft.com/en-us/azure/devops/pipelines/build/triggers?tabs=yaml&amp;view=azure-devops#supported-cron-syntax</span>
<span class="token comment"># schedules:</span>
<span class="token comment">#   - cron: '0 8 * * *'</span>
<span class="token comment">#     branches:</span>
<span class="token comment">#       include: [main]</span>

<span class="token comment"># This group should only be accessible to the release pipeline</span>
<span class="token key atrule">variables</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">group</span><span class="token punctuation">:</span> Beachball secrets

<span class="token comment"># Variable syntax below assumes Linux/Mac but could be easily adapted to Windows</span>
<span class="token key atrule">pool</span><span class="token punctuation">:</span>
  <span class="token key atrule">vmImage</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

<span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token comment"># ... Other steps to set up repo and prepare for publishing (install, build, test, etc) ...</span>

  <span class="token comment"># Set the name, email, and URL with PAT</span>
  <span class="token punctuation">-</span> <span class="token key atrule">script</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      git config user.name &quot;someone&quot;
      git config user.email &quot;someone@example.com&quot;
      git remote set-url origin &quot;https://$(REPO_PAT)@github.com/your-org/your-repo&quot;</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Set git credentials

  <span class="token comment"># Pass the token on the command line for publishing</span>
  <span class="token punctuation">-</span> <span class="token key atrule">script</span><span class="token punctuation">:</span> npm run release <span class="token punctuation">-</span><span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>token &quot;$(NPM_TOKEN)&quot;
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Publish
</code></pre></div><h3 id="azure-repos-azure-pipelines"><a href="#azure-repos-azure-pipelines" class="header-anchor">#</a> Azure Repos + Azure Pipelines</h3> <p>This should be very similar to the GitHub version, aside from possibly the authentication method. You could potentially use personal access tokens for git and npm feed authentication (similar to above), or other methods are available which aren't currently covered here.</p> <p>If you're publishing to a private Azure Artifacts npm feed, be sure to set <code>registry</code> in the <code>beachball</code> config <a href="#setting-options-for-publishing">as described above</a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/beachball/concepts/change-files.html" class="prev">
        Change Files
      </a></span> <span class="next"><a href="/beachball/concepts/groups.html">
        Version Groups
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/beachball/assets/js/app.b3b4e057.js" defer></script><script src="/beachball/assets/js/2.88913962.js" defer></script><script src="/beachball/assets/js/1.73cf2610.js" defer></script><script src="/beachball/assets/js/31.77c50f29.js" defer></script>
  </body>
</html>
